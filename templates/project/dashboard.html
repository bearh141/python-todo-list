{% extends "base.html" %}

{% block title %}Dashboard - To-Do List{% endblock %}

{% block content %}
<h2>My Projects</h2>

<!-- Form tạo project -->
<form method="POST" action="{{ url_for('project.create') }}">
    <input type="text" name="name" placeholder="New Project Name" required>
    <button type="submit">Create Project</button>
</form>

<hr>

<!-- Danh sách project -->
{% for project in projects %}
<div style="border: 1px solid #ccc; margin-bottom: 1em; padding: 1em;">
    <h3>{{ project.name }}</h3>
    <p>{{ project.description }}</p>
    <p>Created: {{ project.created_at.strftime('%Y-%m-%d') }}</p>

    <!-- Form tạo task -->
    <form method="POST" action="{{ url_for('task.create', project_id=project.id) }}">
        <input type="text" name="title" placeholder="New Task" required>
        <input type="date" name="due_date">
        <button type="submit">Add Task</button>
    </form>

    <!-- Danh sách task -->
    <ul>
    {% for task in project.tasks %}
        <li>
            <strong>{{ task.title }}</strong> 
            {% if task.due_date %}(Due: {{ task.due_date.strftime('%Y-%m-%d') }}){% endif %}
            - Status: {{ task.status }}

            <!-- Subtask -->
            <ul>
            {% for subtask in task.subtasks %}
                <li>{{ subtask.title }} - {{ subtask.status }}</li>
            {% endfor %}
            </ul>

            <!-- Form tạo subtask -->
            <form method="POST" action="{{ url_for('task.create_subtask', task_id=task.id) }}">
                <input type="text" name="title" placeholder="New Subtask" required>
                <input type="date" name="due_date">
                <button type="submit">Add Subtask</button>
            </form>
        </li>
    {% endfor %}
    </ul>
</div>
{% else %}
<p>No projects yet. Create your first project!</p>
{% endfor %}
{% endblock %}
